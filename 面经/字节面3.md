#### 一面

##### 输入url到页面渲染完成的过程

* 发起请求
* DNS
* 服务器返回资源
* 构建DOM树
* 构建CSSOM树
* 构建render树 = DOM树 + CSSOM树
* 计算布局
* 绘制

##### TCP/IP协议分层

OSI模型为7层(学院派)

* 应用层
* 表示层
* 会话层
* 传输层
* 网络层
* 链路层
* 物理层

TCP/IP协议5层又是一个单独的*实践分层*(实践派)

* TCP/IP协议将 应用层 表示层 会话层分为了一个大层
* 传输层
* 网络层
* 链路层
* 物理层

当传输数据时是进行层层分包

假设传递一个密码,曾是数据会套上应用层的协议 ->上传输层协议 -> 网络层协议 ->链路层协议 -> 物理层协议 以达到5层协议包裹

当说某某设备工作在第几层时,就代表这个设备是在这个数据的第几层

##### TCP属于哪层协议

TCP在传输层 IP在网络层

##### 为什么TCP挥手比握手多一次

因为是*分别释放*

1. A向B发起FIN关闭连接
2. B收到后返回ACK表示收到
3. 此时A就会进入等待,等待B发起FIN关闭连接
4. B发起FIN关闭连接,进入等待最后一个ACK,因为需要确定A收到这个FIN
5. A收到后返回ACK表示收到,进入time wait状态,等待B,如果B在等待A的这条ACK时一直没有等到,那么B就会重发FIN,A的超时等待刚好是2MSL(*为了确保B收到了A的最后一个ACK*)
6. B关闭连接
7. A等待2MSL后关闭连接

##### 强缓存和协商缓存

强缓存就是由浏览器自行判断资源是否过期

协商缓存会向服务器发起一次资源失效请求,由服务器来判断是否过期

在chrome中*命中强缓存的请求的状态为200*,*但是并没有发出真实的http请求*

命中协商缓存的资源,请求状态为304,*不同浏览器策略不同*

请求过程

当浏览器缓存资源后再次请求时

* 获取该缓存资源的`header`,根据`response header中的expires和cache-control`来*判断是否命中强缓存*,如果命中就从缓存中获取资源
* *如果没有命中强缓存*,浏览器*会请求服务器,这次请求带上IF-Modified-Since或IF-None-Math,*这两个值分别是第一次请求返回的Last-Modified或者Etag,*由服务器来比对是否命中*,如果*命中,服务器返回304*,并且*不会携带资源*,*反之服务器返回资源,并更新header中的缓存字段*

强缓存

根据响应头中的`Expires或cache-control`来控制

* expires:一个*GMT格式的时间字符串*,代表*资源失效时间*

  缺点,这是一个*绝对时间,因为服务器时间和客户端时间基本上是不一致的*,导致expires会造成一些问题

* cache-control

  * max-age:*相对时间,一般由它来判断*

    如cache-control:max-age=3600,代表资源有效期3600秒

  * no-cahce:使用协商缓存

  * no-store:禁止浏览器缓存数据,每次请求资源都会向服务器发起完整资源请求

  * public:可以被所有永华缓存,包括终端用户和CDN等代理服务器

  * private:只能被终端用户的浏览器缓存

协商缓存

由服务器来确定缓存是否有效,*涉及两对属性,成对出现*

*第一次请求*带上某个值*Last-Modified或Etag,**后续请求*带上对应的请求字段*if-Modified-since或if-none-match*

如果响应头没有last-Modified或Etag,那么请求头不会有对应的字段

* Last-Modified/If-Modified-Since

  都是GMT格式的时间字符串

  last-Modified*标记最后文件修改时间*,下一次请求会带上它,服务器判断文件最后修改时间是否一致,如果一致返回304,不会返回资源,反之不一致,返回资源,并且新的last-Modified会在响应头中返回,并在下一次请求之间更新本地缓存的last-Modified,下一次请求时if-Modified-since会启用更新后的last-Modified

* Etag/if-none-Match

  值由服务器为*每一个资源生成唯一标识符*,只要资源发生变化标识符也就发生变化,服务器通过Etag字段返回给浏览器,接收到if-none-mtach后,服务器通过比较两者是否一致来判断文件内容是否需要改变

##### 为什么cache-control优先级更高

因为expires具有缺陷,因为expires是绝对时间,如果服务器时间和客户端时间不一致就会导致缓存失效,出现预期以外的情况

##### html,js,css放在磁盘缓存还是内存缓存

1. 内存缓存:快速读取和时效性

一般js,字体,图片等会放在内存缓存中

2. 磁盘缓存:持久性

css,html等会放在磁盘缓存中

##### CSSOM树和DOM树是同时解析的吗

同时解析,当下载html后就开始生成DOM树,遇到css标签就开始解析css,*这个过程不会阻塞*

